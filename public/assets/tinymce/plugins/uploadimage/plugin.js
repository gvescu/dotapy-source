!function(){tinymce.PluginManager.requireLangPack("uploadimage"),tinymce.create("tinymce.plugins.UploadImage",{UploadImage:function(e,t){function n(){p=h.windowManager.open({title:e.translate("Insert an image from your computer"),width:500+parseInt(h.getLang("uploadimage.delta_width",0),10),height:180+parseInt(h.getLang("uploadimage.delta_height",0),10),body:[{type:"iframe",url:"javascript:void(0)"},{type:"textbox",name:"file",label:e.translate("Choose an image"),subtype:"file"},{type:"textbox",name:"alt",label:e.translate("Image description")},{type:"container",classes:"error",html:"<p style='color: #b94a48;'>&nbsp;</p>"}],buttons:[{text:e.translate("Insert"),onclick:a,subtype:"primary"},{text:e.translate("Cancel"),onclick:e.windowManager.close}]},{plugin_url:t}),p.off("submit"),p.on("submit",a),u=p.find("iframe")[0],d=m("form",{action:e.getParam("uploadimage_form_url","/tinymce_assets"),target:u._id,method:"POST",enctype:"multipart/form-data",accept_charset:"UTF-8"}),u.getEl().name=u._id,d.appendChild(m("input",{type:"hidden",name:"utf8",value:"\u2713"})),d.appendChild(m("input",{type:"hidden",name:"authenticity_token",value:c("csrf-token")})),d.appendChild(m("input",{type:"hidden",name:"hint",value:e.getParam("uploadimage_hint","")}));for(var n=p.getEl(),o=document.getElementById(n.id+"-body"),r=o.getElementsByClassName("mce-container"),i=0;i<r.length;i++)d.appendChild(r[i]);for(var l=d.getElementsByTagName("input"),i=0;i<l.length;i++){var g=l[i];"input"==g.tagName.toLowerCase()&&"hidden"!=g.type&&(g.name="file"==g.type?"file":"alt")}o.appendChild(d)}function a(){if(""==s("file"))return l("You must choose a file");f=new top.tinymce.ui.Throbber(p.getEl()),f.show(),i();var e=u.getEl();e.attachEvent?(e.detachEvent("onload",o),e.attachEvent("onload",o)):(e.removeEventListener("load",o),e.addEventListener("load",o,!1)),d.submit()}function o(){f&&f.hide();var e=u.getEl();if(e.document||e.contentDocument){var t=e.contentDocument||e.contentWindow.document;r(t.getElementsByTagName("body")[0].innerHTML)}else l("Didn't get a response from the server")}function r(t){console.group("Handling response"),console.log("Raw",t);try{var n=tinymce.util.JSON.parse(t);console.log("Parsed",n),n.error?(console.log("It has an error!",n.error.message),l(n.error.message)):(console.log("Inserting",g(n)),e.execCommand("mceInsertContent",!1,g(n)),e.windowManager.close())}catch(a){console.log("Bad response :(",a),l("Got a bad response from the server")}console.groupEnd()}function i(){var e=p.find(".error")[0].getEl();e&&(e.getElementsByTagName("p")[0].innerHTML="&nbsp;")}function l(t){console.log("Handling error",t);var n=p.find(".error")[0].getEl();n&&(n.getElementsByTagName("p")[0].innerHTML=e.translate(t))}function m(e,t){var n=document.createElement(e);for(var a in t)t[a]instanceof Function||(n[a]=t[a]);return n}function g(t){var n=e.getParam("uploadimage_default_img_class",""),a=s("alt"),o="<img src='"+t.image.url+"'";return""!=n&&(o+=" class='"+n+"'"),t.image.height&&(o+=" height='"+t.image.height+"'"),t.image.width&&(o+=" width='"+t.image.width+"'"),o+=" alt='"+a+"'/>"}function s(e){var t=d.getElementsByTagName("input");for(var n in t)if(t[n].name==e)return t[n].value;return""}function c(e){var t=document.getElementsByTagName("meta");for(var n in t)if(t[n].name==e)return t[n].content;return null}var d,u,p,f,h=e;h.addButton("uploadimage",{tooltip:e.translate("Insert an image from your computer"),icon:"image",onclick:n}),h.addMenuItem("uploadimage",{text:e.translate("Insert an image from your computer"),icon:"image",context:"insert",onclick:n})}}),tinymce.PluginManager.add("uploadimage",tinymce.plugins.UploadImage)}();